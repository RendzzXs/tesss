#!/bin/bash

# Pterodactyl Theme Changer - Premium/Dark Theme
# Dibuat untuk tampilan mewah, VIP, dan keren

# Warna untuk output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m' # No Color

# Konfigurasi
PTERODACTYL_DIR="/var/www/pterodactyl"
BACKUP_DIR="/root/pterodactyl_backup"

# Fungsi untuk menampilkan banner
show_banner() {
    clear
    echo -e "${PURPLE}╔══════════════════════════════════════════════════════════╗${NC}"
    echo -e "${PURPLE}║${WHITE}              PTERODACTYL PREMIUM THEME                  ${PURPLE}║${NC}"
    echo -e "${PURPLE}║${WHITE}              Mewah | VIP | Dark Theme                    ${PURPLE}║${NC}"
    echo -e "${PURPLE}╚══════════════════════════════════════════════════════════╝${NC}"
    echo ""
}

# Fungsi untuk mengecek apakah user adalah root
check_root() {
    if [[ $EUID -ne 0 ]]; then
        echo -e "${RED}Error: Script ini harus dijalankan sebagai root!${NC}"
        exit 1
    fi
}

# Fungsi untuk mengecek apakah Pterodactyl terinstall
check_pterodactyl() {
    if [ ! -d "$PTERODACTYL_DIR" ]; then
        echo -e "${RED}Error: Pterodactyl tidak ditemukan di $PTERODACTYL_DIR${NC}"
        exit 1
    fi
}

# Fungsi untuk backup
backup_files() {
    echo -e "${YELLOW}Membuat backup...${NC}"
    mkdir -p "$BACKUP_DIR"
    cp -r "$PTERODACTYL_DIR/resources/views" "$BACKUP_DIR/"
    cp -r "$PTERODACTYL_DIR/public" "$BACKUP_DIR/"
    echo -e "${GREEN}Backup berhasil dibuat di $BACKUP_DIR${NC}"
}

# Fungsi untuk restore backup
restore_backup() {
    echo -e "${YELLOW}Merestore backup...${NC}"
    if [ -d "$BACKUP_DIR" ]; then
        cp -r "$BACKUP_DIR/views" "$PTERODACTYL_DIR/resources/"
        cp -r "$BACKUP_DIR/public" "$PTERODACTYL_DIR/"
        echo -e "${GREEN}Restore berhasil!${NC}"
    else
        echo -e "${RED}Tidak ada backup ditemukan!${NC}"
    fi
}

# Fungsi untuk menginstall tema dark premium
install_dark_theme() {
    echo -e "${CYAN}Menginstall Dark Theme Premium...${NC}"
    
    # Dark Theme CSS
    cat > "$PTERODACTYL_DIR/public/theme/dark-premium.css" << 'EOF'
:root {
    --primary-bg: #0a0c0f;
    --secondary-bg: #1a1e24;
    --card-bg: #1f2329;
    --text-primary: #ffffff;
    --text-secondary: #b0b7c0;
    --accent-color: #6e45e2;
    --accent-hover: #8255f5;
    --border-color: #2d323a;
    --success-color: #3bb75e;
    --danger-color: #e5484d;
    --warning-color: #f0b400;
    --info-color: #4299e1;
}

body {
    background: linear-gradient(135deg, var(--primary-bg) 0%, #0f1217 100%) !important;
    color: var(--text-primary) !important;
}

.navbar {
    background: rgba(26, 30, 36, 0.95) !important;
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border-color);
}

.card {
    background: var(--card-bg) !important;
    border: 1px solid var(--border-color) !important;
    border-radius: 12px !important;
    box-shadow: 0 8px 16px rgba(0,0,0,0.3) !important;
    transition: transform 0.2s, box-shadow 0.2s;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 24px rgba(0,0,0,0.4) !important;
}

.btn-primary {
    background: linear-gradient(135deg, var(--accent-color) 0%, #8b5cf6 100%) !important;
    border: none !important;
    border-radius: 8px !important;
    padding: 8px 16px !important;
    font-weight: 600 !important;
    transition: all 0.2s !important;
}

.btn-primary:hover {
    background: linear-gradient(135deg, var(--accent-hover) 0%, #9f7aea 100%) !important;
    transform: scale(1.05);
}

.server-card {
    background: linear-gradient(135deg, #242931 0%, #1a1e24 100%) !important;
    border-left: 4px solid var(--accent-color) !important;
}

.server-status-online {
    color: var(--success-color) !important;
}

.modal-content {
    background: var(--secondary-bg) !important;
    border: 1px solid var(--border-color) !important;
    border-radius: 16px !important;
}

.table {
    color: var(--text-primary) !important;
}

.table thead th {
    border-bottom: 2px solid var(--border-color) !important;
    color: var(--text-secondary) !important;
}

.table td {
    border-top: 1px solid var(--border-color) !important;
}

.form-control, .form-select {
    background: var(--primary-bg) !important;
    border: 1px solid var(--border-color) !important;
    color: var(--text-primary) !important;
    border-radius: 8px !important;
}

.form-control:focus, .form-select:focus {
    border-color: var(--accent-color) !important;
    box-shadow: 0 0 0 0.2rem rgba(110, 69, 226, 0.25) !important;
}

::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

::-webkit-scrollbar-track {
    background: var(--primary-bg);
}

::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--accent-color);
}

.glow-text {
    text-shadow: 0 0 10px rgba(110, 69, 226, 0.5);
}

.premium-badge {
    background: linear-gradient(135deg, #f5b041 0%, #f39c12 100%);
    color: #000;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
    display: inline-block;
}
EOF

    # Inject CSS ke layout utama
    if [ -f "$PTERODACTYL_DIR/resources/views/layouts/admin.blade.php" ]; then
        sed -i '/<\/head>/i <link rel="stylesheet" href="/theme/dark-premium.css">' "$PTERODACTYL_DIR/resources/views/layouts/admin.blade.php"
    fi
    
    if [ -f "$PTERODACTYL_DIR/resources/views/layouts/base.blade.php" ]; then
        sed -i '/<\/head>/i <link rel="stylesheet" href="/theme/dark-premium.css">' "$PTERODACTYL_DIR/resources/views/layouts/base.blade.php"
    fi

    echo -e "${GREEN}Dark Theme Premium berhasil diinstall!${NC}"
}

# Fungsi untuk menginstall admin menu premium
install_admin_menu() {
    echo -e "${CYAN}Menginstall Admin Menu Premium...${NC}"
    
    # Buat file untuk admin menu customization
    mkdir -p "$PTERODACTYL_DIR/resources/views/admin/theme"
    
    cat > "$PTERODACTYL_DIR/resources/views/admin/theme/premium-menu.blade.php" << 'EOF'
<div class="premium-admin-menu">
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title"><i class="fa fa-crown"></i> Premium Theme Settings</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="premium-feature-card">
                                <i class="fa fa-paint-brush fa-2x mb-2" style="color: #6e45e2;"></i>
                                <h5>Custom Wallpaper</h5>
                                <p>Ubah wallpaper panel sesuai keinginan</p>
                                <button class="btn btn-sm btn-primary" onclick="showWallpaperModal()">Set Wallpaper</button>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="premium-feature-card">
                                <i class="fa fa-palette fa-2x mb-2" style="color: #6e45e2;"></i>
                                <h5>Color Scheme</h5>
                                <p>Sesuaikan warna accent panel</p>
                                <button class="btn btn-sm btn-primary" onclick="showColorModal()">Customize Colors</button>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="premium-feature-card">
                                <i class="fa fa-font fa-2x mb-2" style="color: #6e45e2;"></i>
                                <h5>Typography</h5>
                                <p>Ubah font dan ukuran teks</p>
                                <button class="btn btn-sm btn-primary" onclick="showFontModal()">Customize Fonts</button>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="premium-feature-card">
                                <i class="fa fa-animation fa-2x mb-2" style="color: #6e45e2;"></i>
                                <h5>Animations</h5>
                                <p>Atur efek animasi panel</p>
                                <button class="btn btn-sm btn-primary" onclick="showAnimationModal()">Customize Animations</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.premium-feature-card {
    background: linear-gradient(135deg, #1f2329 0%, #1a1e24 100%);
    border: 1px solid #2d323a;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s;
    height: 100%;
}

.premium-feature-card:hover {
    transform: translateY(-5px);
    border-color: #6e45e2;
    box-shadow: 0 10px 20px rgba(110, 69, 226, 0.2);
}

.premium-feature-card h5 {
    color: #fff;
    margin-bottom: 10px;
}

.premium-feature-card p {
    color: #b0b7c0;
    font-size: 14px;
    margin-bottom: 15px;
}
</style>

<script>
function showWallpaperModal() {
    // Modal untuk upload wallpaper
    let modal = `
        <div class="modal fade" id="wallpaperModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Upload Wallpaper</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="wallpaperForm">
                            <div class="form-group">
                                <label>Pilih Gambar Wallpaper</label>
                                <input type="file" class="form-control" id="wallpaper" accept="image/*">
                            </div>
                            <div class="form-group mt-3">
                                <label>Wallpaper Style</label>
                                <select class="form-control" id="wallpaperStyle">
                                    <option value="cover">Cover (Full)</option>
                                    <option value="contain">Contain</option>
                                    <option value="repeat">Repeat</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="uploadWallpaper()">Upload</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    if(!document.getElementById('wallpaperModal')) {
        document.body.insertAdjacentHTML('beforeend', modal);
    }
    
    let modalInstance = new bootstrap.Modal(document.getElementById('wallpaperModal'));
    modalInstance.show();
}

function uploadWallpaper() {
    let file = document.getElementById('wallpaper').files[0];
    let style = document.getElementById('wallpaperStyle').value;
    
    if(file) {
        let formData = new FormData();
        formData.append('wallpaper', file);
        formData.append('style', style);
        
        fetch('/admin/theme/upload-wallpaper', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').content
            }
        })
        .then(response => response.json())
        .then(data => {
            if(data.success) {
                location.reload();
            }
        });
    }
}

function showColorModal() {
    // Modal untuk custom colors
    let modal = `
        <div class="modal fade" id="colorModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Customize Colors</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="colorForm">
                            <div class="form-group">
                                <label>Accent Color</label>
                                <input type="color" class="form-control form-control-color" id="accentColor" value="#6e45e2">
                            </div>
                            <div class="form-group mt-3">
                                <label>Background Color</label>
                                <input type="color" class="form-control form-control-color" id="bgColor" value="#0a0c0f">
                            </div>
                            <div class="form-group mt-3">
                                <label>Text Color</label>
                                <input type="color" class="form-control form-control-color" id="textColor" value="#ffffff">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="saveColors()">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    if(!document.getElementById('colorModal')) {
        document.body.insertAdjacentHTML('beforeend', modal);
    }
    
    let modalInstance = new bootstrap.Modal(document.getElementById('colorModal'));
    modalInstance.show();
}

function saveColors() {
    let colors = {
        accent: document.getElementById('accentColor').value,
        bg: document.getElementById('bgColor').value,
        text: document.getElementById('textColor').value
    };
    
    fetch('/admin/theme/save-colors', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').content
        },
        body: JSON.stringify(colors)
    })
    .then(response => response.json())
    .then(data => {
        if(data.success) {
            location.reload();
        }
    });
}
</script>
EOF

    # Inject ke admin index
    if [ -f "$PTERODACTYL_DIR/resources/views/admin/index.blade.php" ]; then
        sed -i '/<div class="row">/i @include("admin.theme.premium-menu")' "$PTERODACTYL_DIR/resources/views/admin/index.blade.php"
    fi

    echo -e "${GREEN}Admin Menu Premium berhasil diinstall!${NC}"
}

# Fungsi untuk menginstall wallpaper system
install_wallpaper_system() {
    echo -e "${CYAN}Menginstall Wallpaper System...${NC}"
    
    mkdir -p "$PTERODACTYL_DIR/public/uploads/wallpapers"
    mkdir -p "$PTERODACTYL_DIR/storage/app/wallpapers"
    
    # Buat controller untuk wallpaper
    cat > "$PTERODACTYL_DIR/app/Http/Controllers/ThemeController.php" << 'EOF'
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Storage;

class ThemeController extends Controller
{
    public function uploadWallpaper(Request $request)
    {
        $request->validate([
            'wallpaper' => 'required|image|mimes:jpeg,png,jpg,gif|max:10240',
            'style' => 'required|in:cover,contain,repeat'
        ]);
        
        $file = $request->file('wallpaper');
        $filename = 'wallpaper_' . time() . '.' . $file->getClientOriginalExtension();
        
        // Simpan file
        $path = $file->storeAs('public/wallpapers', $filename);
        
        // Simpan setting
        $settings = [
            'wallpaper' => Storage::url($path),
            'style' => $request->style
        ];
        
        file_put_contents(storage_path('app/wallpapers/settings.json'), json_encode($settings));
        
        return response()->json(['success' => true]);
    }
    
    public function saveColors(Request $request)
    {
        $colors = $request->all();
        file_put_contents(storage_path('app/wallpapers/colors.json'), json_encode($colors));
        
        return response()->json(['success' => true]);
    }
    
    public function getThemeSettings()
    {
        $wallpaper = [];
        $colors = [];
        
        if (file_exists(storage_path('app/wallpapers/settings.json'))) {
            $wallpaper = json_decode(file_get_contents(storage_path('app/wallpapers/settings.json')), true);
        }
        
        if (file_exists(storage_path('app/wallpapers/colors.json'))) {
            $colors = json_decode(file_get_contents(storage_path('app/wallpapers/colors.json')), true);
        }
        
        return response()->json([
            'wallpaper' => $wallpaper,
            'colors' => $colors
        ]);
    }
}
EOF

    # Tambahkan routes
    if [ -f "$PTERODACTYL_DIR/routes/web.php" ]; then
        echo "" >> "$PTERODACTYL_DIR/routes/web.php"
        echo "// Theme Routes" >> "$PTERODACTYL_DIR/routes/web.php"
        echo "Route::post('/admin/theme/upload-wallpaper', [App\Http\Controllers\ThemeController::class, 'uploadWallpaper'])->middleware('auth');" >> "$PTERODACTYL_DIR/routes/web.php"
        echo "Route::post('/admin/theme/save-colors', [App\Http\Controllers\ThemeController::class, 'saveColors'])->middleware('auth');" >> "$PTERODACTYL_DIR/routes/web.php"
        echo "Route::get('/admin/theme/settings', [App\Http\Controllers\ThemeController::class, 'getThemeSettings'])->middleware('auth');" >> "$PTERODACTYL_DIR/routes/web.php"
    fi

    # Inject theme settings ke layout
    cat > "$PTERODACTYL_DIR/public/theme/theme-loader.js" << 'EOF'
document.addEventListener('DOMContentLoaded', function() {
    // Load theme settings
    fetch('/admin/theme/settings')
        .then(response => response.json())
        .then(data => {
            // Apply wallpaper
            if(data.wallpaper && data.wallpaper.wallpaper) {
                let style = data.wallpaper.style || 'cover';
                let wallpaperStyle = '';
                
                if(style === 'cover') {
                    wallpaperStyle = 'background: url("' + data.wallpaper.wallpaper + '") no-repeat center center fixed; background-size: cover;';
                } else if(style === 'contain') {
                    wallpaperStyle = 'background: url("' + data.wallpaper.wallpaper + '") no-repeat center center fixed; background-size: contain; background-color: #0a0c0f;';
                } else {
                    wallpaperStyle = 'background: url("' + data.wallpaper.wallpaper + '") repeat;';
                }
                
                document.body.style.cssText += wallpaperStyle;
            }
            
            // Apply colors
            if(data.colors) {
                if(data.colors.accent) {
                    document.documentElement.style.setProperty('--accent-color', data.colors.accent);
                }
                if(data.colors.bg) {
                    document.documentElement.style.setProperty('--primary-bg', data.colors.bg);
                }
                if(data.colors.text) {
                    document.documentElement.style.setProperty('--text-primary', data.colors.text);
                }
            }
        });
});
EOF

    # Load theme loader
    if [ -f "$PTERODACTYL_DIR/resources/views/layouts/base.blade.php" ]; then
        sed -i '/<\/body>/i <script src="/theme/theme-loader.js"></script>' "$PTERODACTYL_DIR/resources/views/layouts/base.blade.php"
    fi

    echo -e "${GREEN}Wallpaper System berhasil diinstall!${NC}"
}

# Fungsi untuk install animasi premium
install_premium_animations() {
    echo -e "${CYAN}Menginstall Premium Animations...${NC}"
    
    cat > "$PTERODACTYL_DIR/public/theme/premium-animations.css" << 'EOF'
/* Premium Animations */
@keyframes glowPulse {
    0% { box-shadow: 0 0 5px rgba(110, 69, 226, 0.2); }
    50% { box-shadow: 0 0 20px rgba(110, 69, 226, 0.6); }
    100% { box-shadow: 0 0 5px rgba(110, 69, 226, 0.2); }
}

@keyframes float {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-5px); }
    100% { transform: translateY(0px); }
}

@keyframes shimmer {
    0% { background-position: -1000px 0; }
    100% { background-position: 1000px 0; }
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Animation Classes */
.animate-glow {
    animation: glowPulse 2s infinite;
}

.animate-float {
    animation: float 3s ease-in-out infinite;
}

.animate-shimmer {
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    background-size: 1000px 100%;
    animation: shimmer 3s infinite;
}

.animate-rotate {
    animation: rotate 10s linear infinite;
}

.animate-fadeInUp {
    animation: fadeInUp 0.6s ease-out;
}

/* Card Animations */
.card {
    animation: fadeInUp 0.5s ease-out;
    animation-fill-mode: both;
}

.card:nth-child(1) { animation-delay: 0.1s; }
.card:nth-child(2) { animation-delay: 0.2s; }
.card:nth-child(3) { animation-delay: 0.3s; }
.card:nth-child(4) { animation-delay: 0.4s; }
.card:nth-child(5) { animation-delay: 0.5s; }
.card:nth-child(6) { animation-delay: 0.6s; }

/* Hover Effects */
.btn:hover {
    animation: float 0.5s ease-in-out;
}

.server-card:hover {
    animation: glowPulse 1.5s infinite;
}

/* Loading Animation */
.premium-loader {
    width: 50px;
    height: 50px;
    border: 3px solid var(--border-color);
    border-top: 3px solid var(--accent-color);
    border-radius: 50%;
    animation: rotate 1s linear infinite;
}

/* Status Badge Animations */
.status-badge {
    position: relative;
    overflow: hidden;
}

.status-badge::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: shimmer 2s infinite;
}
EOF

    # Inject animations CSS
    if [ -f "$PTERODACTYL_DIR/resources/views/layouts/base.blade.php" ]; then
        sed -i '/<\/head>/i <link rel="stylesheet" href="/theme/premium-animations.css">' "$PTERODACTYL_DIR/resources/views/layouts/base.blade.php"
    fi

    echo -e "${GREEN}Premium Animations berhasil diinstall!${NC}"
}

# Fungsi untuk install custom font
install_custom_fonts() {
    echo -e "${CYAN}Menginstall Custom Fonts...${NC}"
    
    cat > "$PTERODACTYL_DIR/public/theme/custom-fonts.css" << 'EOF'
/* Google Fonts Import */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap');

/* Font Classes */
.font-poppins { font-family: 'Poppins', sans-serif; }
.font-inter { font-family: 'Inter', sans-serif; }
.font-montserrat { font-family: 'Montserrat', sans-serif; }

/* Premium Typography */
.premium-title {
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    letter-spacing: -0.02em;
}

.premium-subtitle {
    font-family: 'Inter', sans-serif;
    font-weight: 500;
    color: var(--text-secondary);
}

.premium-text {
    font-family: 'Inter', sans-serif;
    font-weight: 400;
    line-height: 1.6;
}

/* Gradient Text */
.gradient-text {
    background: linear-gradient(135deg, #6e45e2 0%, #9f7aea 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Apply default font */
body {
    font-family: 'Inter', sans-serif;
}

h1, h2, h3, h4, h5, h6 {
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
}
EOF

    # Inject custom fonts
    if [ -f "$PTERODACTYL_DIR/resources/views/layouts/base.blade.php" ]; then
        sed -i '/<\/head>/i <link rel="stylesheet" href="/theme/custom-fonts.css">' "$PTERODACTYL_DIR/resources/views/layouts/base.blade.php"
    fi

    echo -e "${GREEN}Custom Fonts berhasil diinstall!${NC}"
}

# Fungsi untuk clear cache
clear_cache() {
    echo -e "${YELLOW}Membersihkan cache...${NC}"
    cd "$PTERODACTYL_DIR"
    php artisan view:clear
    php artisan cache:clear
    php artisan config:clear
    echo -e "${GREEN}Cache berhasil dibersihkan!${NC}"
}

# Fungsi untuk set permissions
set_permissions() {
    echo -e "${YELLOW}Mengatur permissions...${NC}"
    chown -R www-data:www-data "$PTERODACTYL_DIR"
    chmod -R 755 "$PTERODACTYL_DIR/storage"
    chmod -R 755 "$PTERODACTYL_DIR/bootstrap/cache"
    echo -e "${GREEN}Permissions berhasil diatur!${NC}"
}

# Menu utama
main_menu() {
    show_banner
    echo -e "${WHITE}Pilih opsi:${NC}"
    echo -e "${CYAN}1.${NC} Install Semua (Full Premium Theme)"
    echo -e "${CYAN}2.${NC} Install Dark Theme Only"
    echo -e "${CYAN}3.${NC} Install Admin Menu Premium"
    echo -e "${CYAN}4.${NC} Install Wallpaper System"
    echo -e "${CYAN}5.${NC} Install Premium Animations"
    echo -e "${CYAN}6.${NC} Install Custom Fonts"
    echo -e "${CYAN}7.${NC} Restore Backup"
    echo -e "${CYAN}8.${NC} Clear Cache"
    echo -e "${CYAN}9.${NC} Set Permissions"
    echo -e "${CYAN}0.${NC} Exit"
    echo ""
    echo -e "${YELLOW}Masukkan pilihan [0-9]:${NC} "
    read -r choice

    case $choice in
        1)
            backup_files
            install_dark_theme
            install_admin_menu
            install_wallpaper_system
            install_premium_animations
            install_custom_fonts
            clear_cache
            set_permissions
            echo -e "${GREEN}✓ Semua tema premium berhasil diinstall!${NC}"
            echo -e "${PURPLE}Silahkan refresh panel Pterodactyl Anda!${NC}"
            ;;
        2)
            backup_files
            install_dark_theme
            clear_cache
            set_permissions
            echo -e "${GREEN}✓ Dark Theme berhasil diinstall!${NC}"
            ;;
        3)
            backup_files
            install_admin_menu
            clear_cache
            set_permissions
            echo -e "${GREEN}✓ Admin Menu Premium berhasil diinstall!${NC}"
            ;;
        4)
            backup_files
            install_wallpaper_system
            clear_cache
            set_permissions
            echo -e "${GREEN}✓ Wallpaper System berhasil diinstall!${NC}"
            ;;
        5)
            backup_files
            install_premium_animations
            clear_cache
            set_permissions
            echo -e "${GREEN}✓ Premium Animations berhasil diinstall!${NC}"
            ;;
        6)
            backup_files
            install_custom_fonts
            clear_cache
            set_permissions
            echo -e "${GREEN}✓ Custom Fonts berhasil diinstall!${NC}"
            ;;
        7)
            restore_backup
            clear_cache
            set_permissions
            echo -e "${GREEN}✓ Restore backup selesai!${NC}"
            ;;
        8)
            clear_cache
            ;;
        9)
            set_permissions
            ;;
        0)
            echo -e "${YELLOW}Terima kasih telah menggunakan script ini!${NC}"
            exit 0
            ;;
        *)
            echo -e "${RED}Pilihan tidak valid!${NC}"
            sleep 2
            main_menu
            ;;
    esac
}

# Main execution
check_root
check_pterodactyl

# Buat directory theme jika belum ada
mkdir -p "$PTERODACTYL_DIR/public/theme"

# Jalankan menu utama
main_menu
